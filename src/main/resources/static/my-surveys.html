<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><title>æˆ‘çš„é—®å·</title><link rel="stylesheet" href="/static/style.css"><script src="/static/api.js"></script></head><body>
<header>
  <div class="logo">USTB Survey</div>
  <nav>
    <a href="/static/index.html">é¦–é¡µ</a>
    <a href="/static/create-survey.html">åˆ›å»º</a>
    <a href="/static/my-surveys.html" class="current">æˆ‘çš„é—®å·</a>
    <a href="/static/shared-surveys.html">å…±äº«ç»™æˆ‘</a>
  </nav>
</header>
<main>
  <section class="panel stack">
    <div>
      <h2>æˆ‘çš„é—®å·</h2>
      <p class="muted">æŸ¥çœ‹ã€åˆ†äº«æˆ–ç¼–è¾‘æˆ‘åˆ›å»ºçš„å…¨éƒ¨é—®å·ï¼Œå¹¶å¯ä¸€é”®å¤åˆ¶å…¬å¼€ç­”é¢˜é“¾æ¥ã€‚</p>
    </div>
    <div id="list"></div>
    <div id="pager" class="pill-group" style="justify-content:flex-end"></div>
  </section>
</main>
<script>
AppBoot.waitAPI(()=>{
  if(typeof $!=='function'){ console.error('[my-surveys] $ æœªå®šä¹‰'); return; }
  let currentPage = 1; let totalPages = 1; let pageSize=20; let total=0;
  async function load(page=1){ try { const data = await API.listMySurveys(page); render(data); } catch(e){ toast('åŠ è½½å¤±è´¥','error'); } }
  function render(data){
    const items = data.items || data; currentPage = data.page || 1; pageSize = data.page_size || items.length || 20; total = data.total != null ? data.total : items.length; totalPages = Math.max(1, Math.ceil(total / pageSize));
    const c=$('#list'); c.innerHTML='';
  if(!items.length){ c.innerHTML='<div class="empty">å°šæœªåˆ›å»ºä»»ä½•é—®å·ï¼Œç‚¹å‡»â€œåˆ›å»ºâ€ç«‹å³å¼€å§‹ ğŸ¯</div>'; buildPager(); return; }
  const table=document.createElement('table'); table.className='table'; table.innerHTML='<thead><tr><th>ID</th><th>æ ‡é¢˜</th><th>åˆ†äº«</th><th>ç­”é¢˜é“¾æ¥</th><th>è®°åˆ†æ¦œ</th><th>å¤åˆ¶é“¾æ¥</th><th>ç¼–è¾‘</th><th>åˆ é™¤</th></tr></thead>';
    const tb=document.createElement('tbody');
  items.forEach(s=>{ const id = s.surveyId || s.id; const title = s.surveyTitle || s.title || '(æœªå‘½å)'; const linkPath = '/static/survey.html?id='+id; const absLink = (location.origin||'') + linkPath; const tr=document.createElement('tr'); tr.innerHTML=`<td>${id}</td><td>${title}</td><td><a href="/static/shares.html?surveyId=${id}">ç®¡ç†</a></td><td><a href="${linkPath}" target="_blank">æ‰“å¼€</a></td><td><a href="/static/scoreboard.html?id=${id}">æŸ¥çœ‹</a></td><td><button data-copy="${absLink}" class="secondary">å¤åˆ¶</button></td><td><button data-edit="${id}" class="secondary">ç¼–è¾‘</button></td><td><button data-del="${id}" class="danger">åˆ é™¤</button></td>`; tb.appendChild(tr); });
    table.appendChild(tb); c.appendChild(table);
    c.querySelectorAll('button[data-del]').forEach(btn=>{ btn.onclick=async ()=>{ if(btn.disabled) return; if(!confirm('ç¡®è®¤åˆ é™¤?'))return; const id=btn.getAttribute('data-del'); const original=btn.textContent; btn.disabled=true; btn.textContent='åˆ é™¤ä¸­...'; try{ await API.deleteSurvey(id); toast('å·²åˆ é™¤'); load(currentPage); }catch(e){ toast('åˆ é™¤å¤±è´¥','error'); btn.disabled=false; btn.textContent=original; } }; });
    c.querySelectorAll('button[data-edit]').forEach(btn=>{ btn.onclick=()=>{ location.href='/static/edit-survey.html?id='+btn.getAttribute('data-edit'); }; });
    c.querySelectorAll('button[data-copy]').forEach(btn=>{ btn.onclick=()=>{ const link=btn.getAttribute('data-copy'); navigator.clipboard?.writeText(link).then(()=>toast('å·²å¤åˆ¶é“¾æ¥')).catch(()=>{ try { const ta=document.createElement('textarea'); ta.value=link; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); toast('å·²å¤åˆ¶'); } catch { prompt('å¤åˆ¶å¤±è´¥ï¼Œæ‰‹åŠ¨å¤åˆ¶:', link); } }); }; });
    buildPager();
  }
  function buildPager(){ const pg=$('#pager'); pg.innerHTML=''; if(total==null) return; const info=document.createElement('span'); info.textContent=`ç¬¬ ${currentPage}/${totalPages} é¡µ Â· å…± ${total} æ¡`; info.className='muted'; const prev=document.createElement('button'); prev.className='secondary'; prev.textContent='ä¸Šä¸€é¡µ'; prev.disabled=currentPage<=1; prev.onclick=()=>load(currentPage-1); const next=document.createElement('button'); next.className='secondary'; next.textContent='ä¸‹ä¸€é¡µ'; next.disabled=currentPage>=totalPages; next.onclick=()=>load(currentPage+1); pg.appendChild(prev); pg.appendChild(next); pg.appendChild(info); }
  load();
  API.injectUserNav();
});
</script>
</body></html>